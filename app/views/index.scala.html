@(request: play.mvc.Http.Request)
<!DOCTYPE html>

@main("Welcome to Play") {

<html>
<head>
  <script type='text/javascript' src='https://code.jquery.com/jquery-3.3.1.min.js'></script>;
  <script type='text/javascript' src='@routes.Assets.at("javascript/index.js")'></script>
</head>

<body data-ws-url="@routes.HomeController.ws.webSocketURL(request)">
<div class="text-center mt-3">
  <h3>Welcome to Freelancer Analyser!</h3>
</div>
<div id="time"> </div>
</body>
</html>
  <div class="row mt-5">
    <div class="col-4"></div>
    <div class="col-4">
      <div class="form-group has-search">

        <input id="search" type="text" class="form-control" placeholder="Enter search terms">

      </div>
    </div>
    <div class="col-4">
      <button id="go-button" class="btn btn-primary">
        <span class="fa fa-search form-control-feedback"></span>
        Go
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-2"></div>

    <div class="col-8" id="result">

    </div>
    <div class="col-2"></div>

  </div>
}

<script>
var statsId = 0;
$("#stats").addClass("disableStats");

$("#go-button").click(function() {
    $.get("/get-search-term/" + $("#search").val(), function(data, status) {


        for (let i = 0; i < data['result']['projects'].length; i++) {

            var projectTitle = ', <a target="_blank" href="https://www.freelancer.com/projects/' + data['result']['projects'][i]['seo_url'] + '">' + data['result']['projects'][i]['title'] + '</a>';
            var ownerProfileId = data['result']['projects'][i]['owner_id'];
            var projectId = data['result']['projects'][i]['id'];
            var preview_des = data['result']['projects'][i]['preview_description'];
            var submitDate = new Date(data['result']['projects'][i]['submitdate'] * 1000).toDateString();
            var type = data['result']['projects'][i]['type'];

            var allSkills = new Array();
            for (let j = 0; j < data['result']['projects'][i]['jobs'].length; j++) {
                var skill = data['result']['projects'][i]['jobs'][j]['name'];
                allSkills.push('<a href="/skills/' + skill + '">' + skill + '.</a>');
            }
            var refined = allSkills.join(' ');


            $("#result").prepend('<li> <a href="/owner-profile/' + ownerProfileId + '">' + ownerProfileId + '</a> ' + submitDate +
                projectTitle + ', Type: ' + type + ', <b>[</b>Skills: ' + refined + '<b>]</b>.</a> <a href ="/stats/single/' + projectId + '">Stats.</a> <a target="_blank" href="/readablity/' + encodeURIComponent(preview_des) + '">Readability</a> </li>')
        }

        $("#result").prepend(' <span>FKGL: ' + data['score']['avgFKGL'] + '</span> <br><a href =query id="statsLink">Global Stats</a>');
        $("#result").prepend(' : <span>Flesh Reading Ease Index: ' + data['score']['avgFREI'] + '</span>');
        $("#result").prepend('<label class="fw-bold">Search terms: ' + $("#search").val() + "</label>");
        $("#result").prepend('<div class="mt-5"></div>');

        //Word stats parsing

        (function() {
            var newId = "statsLink" + statsId
            document.getElementById("statsLink").id = newId;
            var query = $("#search").val();
            var strLink = "stats/" + query;
            document.getElementById(newId).setAttribute("href", strLink);
        })();
        statsId++;
        $("#stats").addClass("enableStats");
        ///

        $("#search").val("");
    });

});
</script>
<script>
    (function() {
  $(function() {
    var ws;
    ws = new WebSocket($("body").data("ws-url"));
    return ws.onmessage = function(event) {
      var message;
      message = JSON.parse(event.data);
      return $('#time').append(message.time + "<br/>");
    };
  });

}).call(this);
</script>

<style>
  .disableStats {
    pointer-events: none;
    opacity: 0.0;
}

.enableStats {
    pointer-events: auto;
    opacity: 1.0;
}
</style>
